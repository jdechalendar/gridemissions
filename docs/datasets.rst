.. _datasets:

Datasets
========
Two types of datasets are made available through this project: 1) live and 2) historical (or “bulk”).

Live
----
The "live" datasets are used to make the maps at `energy.stanford.edu/gridemissions`_ and are also available via the ``api`` module in this package. These currently include two weeks' worth of data. The live datasets are updated on an hourly basis using a cron job that runs script ``src/gridemissions/scripts/update_live_dataset.sh``. That script pulls data from the EIA API and then runs the workflows in this package to process the data.

Bulk
----
The "bulk" datasets correspond to the six-month files made available by the EIA. The datasets can be generated by running ``make bulk``. These datasets are used to make the reports that can be found at `energy.stanford.edu/gridemissions`_ (Heatmaps and Timeseries tabs).

The bulk dataset is now versioned. The latest version is available at https://api.gridemissions.com/bulk/latest and version X.Y.Z is avavailable at https://api.gridemissions.com/bulk/X.Y.Z

.. note::
    The EIA data files are split in six-month chunks using local time. Because the continental BAs span three time zones, this means that in UTC, some timestamps are missing in adjacent six-month files. This previously resulted in duplicate rows in the six month files produced by the workflows in this repository. See `this GH issue`_ for more details.

    The bulk dataset provided by this repository is stored using UTC (and is the time at the end of each period, similar to the EIA convention).

Memo of how I make the datasets and reports publicly available:

1. upload bulk files to the Stanford AWS EC2 instance that has access (e.g., via ``scp processed.tar.gz ge-priv:/data/ec2-user/EIA_Grid_Monitor/.``)
2. ``make bulk_upload`` to upload the dataset to the S3 bucket
3. ``make bulk_report`` to make the automated reports and upload them to S3 bucket
4. Delete uncompressed version of the archive on the EC2 instance to save space


.. _energy.stanford.edu/gridemissions: https://energy.stanford.edu/gridemissions
.. _this GH issue: https://github.com/jdechalendar/gridemissions/issues/30
